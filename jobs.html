<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Ambore Jobs â€” Tech & IT Jobs Across the USA</title>
<meta name="description" content="Browse 4,000+ fresh US tech jobs from Greenhouse, Ashby, Workday, Lever, WeWorkRemotely, Adzuna, USAJobs, and more. Updated daily."/>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%234F46E5'/><stop offset='100%25' stop-color='%237C3AED'/></linearGradient></defs><rect width='100' height='100' rx='22' fill='url(%23g)'/><text x='50' y='72' font-size='62' font-family='Arial,sans-serif' font-weight='900' fill='white' text-anchor='middle'>A</text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<script>
function track(event,page){fetch('https://web-production-d62ab.up.railway.app/api/track',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({event,page})}).catch(()=>{});}
window.addEventListener('load',()=>track('page_view','jobs'));
</script>
<script>
// Auth guard
(function(){
  var s=JSON.parse(localStorage.getItem('ambore_user')||'null');
  if(!s||(s.expiresAt&&Date.now()>s.expiresAt)){
    localStorage.removeItem('ambore_user');
    window.location.href='index.html?auth=login&redirect=jobs.html&msg=Please+log+in+to+browse+jobs';
  }
})();
</script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100vh;font-family:'Inter',sans-serif;background:#06060f;color:#e2e8f0}
:root{
  --grad:linear-gradient(135deg,#4F46E5,#7C3AED);
  --card:#0e0e1d;--card2:#13132a;
  --border:rgba(255,255,255,0.08);
  --accent:#818CF8;--green:#22c55e;--yellow:#fbbf24;--red:#ef4444;
}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:2px}
button,input,textarea,select{font-family:inherit}
a{text-decoration:none;color:inherit}

/* â•â• TOPBAR â•â• */
.topbar{
  display:flex;align-items:center;gap:12px;padding:14px 24px;
  border-bottom:1px solid var(--border);background:rgba(14,14,29,0.9);
  position:sticky;top:0;z-index:100;backdrop-filter:blur(12px);
}
.topbar .logo{display:flex;align-items:center;gap:8px;font-size:1rem;font-weight:900;color:#fff}
.topbar .logo-icon{width:28px;height:28px;border-radius:8px;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:900;color:#fff}
.topbar .brand-tag{font-size:0.7rem;font-weight:700;color:var(--accent);background:rgba(79,70,229,0.15);padding:2px 8px;border-radius:6px;margin-left:2px}
.nav-links{display:flex;align-items:center;gap:16px;margin-left:20px}
.nav-links a{font-size:0.82rem;font-weight:600;color:rgba(255,255,255,0.4);transition:color 0.2s}
.nav-links a:hover{color:#fff}
.nav-links a.active{color:var(--accent)}

/* â•â• HERO / SEARCH â•â• */
.hero{
  padding:40px 24px 32px;text-align:center;
  background:linear-gradient(180deg,rgba(79,70,229,0.08) 0%,transparent 100%);
}
.hero h1{font-size:2rem;font-weight:900;color:#fff;margin-bottom:6px}
.hero h1 span{background:var(--grad);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero p{font-size:0.95rem;color:rgba(255,255,255,0.45);margin-bottom:24px}
.stats-bar{display:flex;gap:20px;justify-content:center;margin-bottom:24px;flex-wrap:wrap}
.stat-chip{font-size:0.78rem;color:rgba(255,255,255,0.5);background:rgba(255,255,255,0.04);border:1px solid var(--border);padding:4px 12px;border-radius:20px}
.stat-chip strong{color:var(--accent);font-weight:800}

/* Search bar */
.search-bar{
  display:flex;gap:10px;max-width:720px;margin:0 auto;
}
.search-bar input{
  flex:1;padding:13px 18px;background:var(--card);border:1px solid var(--border);
  border-radius:12px;color:#fff;font-size:0.92rem;outline:none;transition:border-color 0.2s;
}
.search-bar input:focus{border-color:rgba(79,70,229,0.5)}
.search-bar input::placeholder{color:rgba(255,255,255,0.2)}
.search-bar select{
  padding:13px 14px;background:var(--card);border:1px solid var(--border);
  border-radius:12px;color:#fff;font-size:0.85rem;outline:none;cursor:pointer;min-width:160px;
}
.search-bar select option{background:#0e0e1d;color:#fff}
.search-btn{
  padding:13px 28px;background:var(--grad);border:none;border-radius:12px;
  color:#fff;font-size:0.9rem;font-weight:700;cursor:pointer;white-space:nowrap;
  transition:opacity 0.2s;
}
.search-btn:hover{opacity:0.88}

/* Category pills */
.category-pills{
  display:flex;gap:8px;justify-content:center;flex-wrap:wrap;
  margin-top:20px;max-width:800px;margin-left:auto;margin-right:auto;
}
.cat-pill{
  padding:5px 14px;border-radius:20px;font-size:0.76rem;font-weight:600;
  cursor:pointer;border:1px solid var(--border);background:rgba(255,255,255,0.04);
  color:rgba(255,255,255,0.5);transition:all 0.15s;
}
.cat-pill:hover{border-color:rgba(79,70,229,0.4);color:var(--accent)}
.cat-pill.active{background:rgba(79,70,229,0.15);border-color:rgba(79,70,229,0.4);color:var(--accent)}

/* â•â• MAIN LAYOUT â•â• */
.main-layout{
  display:flex;gap:20px;max-width:1200px;margin:0 auto;padding:20px 24px 48px;
}

/* Sidebar filters */
.sidebar{width:240px;flex-shrink:0}
.filter-card{
  background:var(--card);border:1px solid var(--border);border-radius:14px;
  padding:16px;margin-bottom:14px;
}
.filter-title{font-size:0.72rem;font-weight:700;color:rgba(255,255,255,0.4);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:10px}
.filter-option{
  display:flex;align-items:center;gap:8px;padding:5px 0;cursor:pointer;
  font-size:0.82rem;color:rgba(255,255,255,0.6);transition:color 0.15s;
}
.filter-option:hover{color:#fff}
.filter-option input[type=checkbox]{accent-color:#4F46E5}
.filter-option .count{margin-left:auto;font-size:0.7rem;color:rgba(255,255,255,0.25)}
.filter-select{
  width:100%;padding:8px 10px;background:var(--card2);border:1px solid var(--border);
  border-radius:8px;color:#fff;font-size:0.82rem;outline:none;cursor:pointer;
}
.filter-select option{background:#0e0e1d;color:#fff}
.clear-filters{
  font-size:0.76rem;color:var(--accent);background:none;border:none;cursor:pointer;
  padding:8px 0;display:block;width:100%;text-align:center;font-weight:600;
}

/* Jobs list */
.jobs-area{flex:1;min-width:0}
.jobs-header{
  display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:8px;
}
.jobs-count{font-size:0.88rem;color:rgba(255,255,255,0.5)}
.jobs-count strong{color:#fff}
.sort-select{
  padding:6px 10px;background:var(--card);border:1px solid var(--border);
  border-radius:8px;color:rgba(255,255,255,0.6);font-size:0.78rem;outline:none;cursor:pointer;
}

/* Job card */
.job-card{
  background:var(--card);border:1px solid var(--border);border-radius:14px;
  padding:18px 20px;margin-bottom:10px;transition:border-color 0.2s;cursor:pointer;
  display:block;position:relative;
}
.job-card:hover{border-color:rgba(79,70,229,0.4)}
.save-job-btn{
  position:absolute;top:12px;right:12px;
  background:rgba(255,255,255,0.04);border:1px solid var(--border);
  border-radius:7px;padding:4px 9px;font-size:0.75rem;font-weight:600;
  color:rgba(255,255,255,0.35);cursor:pointer;z-index:2;transition:all 0.15s;
  line-height:1.3;
}
.save-job-btn:hover{color:var(--accent);border-color:rgba(129,140,248,0.4);background:rgba(79,70,229,0.08)}
.save-job-btn.saved{color:#818CF8;border-color:rgba(129,140,248,0.35);background:rgba(79,70,229,0.1)}
.job-card-top{display:flex;align-items:flex-start;gap:14px}
.job-logo{
  width:44px;height:44px;border-radius:10px;background:rgba(79,70,229,0.15);
  display:flex;align-items:center;justify-content:center;flex-shrink:0;
  font-size:1rem;font-weight:800;color:var(--accent);overflow:hidden;
}
.job-logo img{width:100%;height:100%;object-fit:cover;border-radius:10px}
.job-info{flex:1;min-width:0}
.job-title{font-size:0.95rem;font-weight:700;color:#fff;margin-bottom:2px;line-height:1.3}
.job-company{font-size:0.82rem;color:rgba(255,255,255,0.5);margin-bottom:6px}
.job-meta{display:flex;flex-wrap:wrap;gap:6px;align-items:center}
.job-tag{
  font-size:0.68rem;font-weight:600;padding:3px 8px;border-radius:6px;
  background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.5);border:1px solid var(--border);
}
.job-tag.remote{color:var(--green);border-color:rgba(34,197,94,0.25);background:rgba(34,197,94,0.08)}
.job-tag.hybrid{color:var(--yellow);border-color:rgba(251,191,36,0.25);background:rgba(251,191,36,0.08)}
.job-tag.salary{color:var(--accent);border-color:rgba(79,70,229,0.25);background:rgba(79,70,229,0.08)}
.job-time{font-size:0.7rem;color:rgba(255,255,255,0.3);margin-left:auto}

/* Job card action row */
.job-card-actions{
  display:flex;align-items:center;gap:8px;margin-top:12px;
  padding-top:11px;border-top:1px solid var(--border);
}
.btn-tailor{
  display:inline-flex;align-items:center;gap:5px;
  padding:6px 13px;border-radius:8px;font-size:0.76rem;font-weight:700;
  background:rgba(79,70,229,0.12);border:1px solid rgba(79,70,229,0.3);
  color:var(--accent);cursor:pointer;transition:all 0.15s;white-space:nowrap;
}
.btn-tailor:hover{background:rgba(79,70,229,0.22);border-color:rgba(129,140,248,0.5);color:#fff}
.btn-apply{
  margin-left:auto;
  display:inline-flex;align-items:center;gap:4px;
  padding:6px 14px;border-radius:8px;font-size:0.76rem;font-weight:700;
  background:var(--grad);border:none;color:#fff;
  cursor:pointer;text-decoration:none;transition:opacity 0.15s;white-space:nowrap;
}
.btn-apply:hover{opacity:0.85}

/* Pagination */
.pagination{display:flex;gap:6px;justify-content:center;margin-top:24px;flex-wrap:wrap}
.page-btn{
  padding:7px 14px;border-radius:8px;font-size:0.8rem;font-weight:600;
  cursor:pointer;border:1px solid var(--border);background:rgba(255,255,255,0.04);
  color:rgba(255,255,255,0.5);transition:all 0.15s;
}
.page-btn:hover{border-color:rgba(79,70,229,0.4);color:#fff}
.page-btn.active{background:var(--grad);border-color:transparent;color:#fff}
.page-btn:disabled{opacity:0.3;cursor:not-allowed}

/* Loading & Empty */
.loading{text-align:center;padding:60px 20px;color:rgba(255,255,255,0.3)}
.loading-spinner{
  width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);
  border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px;
}
@keyframes spin{to{transform:rotate(360deg)}}
.empty-state{text-align:center;padding:60px 20px;color:rgba(255,255,255,0.3)}
.empty-state p{font-size:0.92rem}

/* â•â• MOBILE â•â• */
@media(max-width:768px){
  .main-layout{flex-direction:column}
  .sidebar{width:100%;order:2}
  .jobs-area{order:1}
  .filter-card{display:none}
  .sidebar.open .filter-card{display:block}
  .mobile-filter-toggle{
    display:flex;align-items:center;justify-content:center;gap:6px;
    width:100%;padding:10px;background:var(--card);border:1px solid var(--border);
    border-radius:10px;color:rgba(255,255,255,0.6);font-size:0.82rem;font-weight:600;
    cursor:pointer;margin-bottom:10px;
  }
}
@media(min-width:769px){
  .mobile-filter-toggle{display:none}
}
@media(max-width:640px){
  .topbar{padding:10px 14px;gap:8px;flex-wrap:wrap}
  .topbar .logo{font-size:0.9rem}
  .nav-links{margin-left:0;gap:10px;order:3;width:100%;justify-content:center;padding-top:6px;border-top:1px solid var(--border)}
  .hero{padding:24px 14px 20px}
  .hero h1{font-size:1.4rem}
  .hero p{font-size:0.82rem;margin-bottom:16px}
  .search-bar{flex-direction:column;gap:8px}
  .search-bar select{min-width:auto}
  .stats-bar{gap:10px}
  .stat-chip{font-size:0.7rem}
  .category-pills{gap:5px;margin-top:14px}
  .main-layout{padding:14px 12px 36px;gap:12px}
  .job-card{padding:14px}
  .job-logo{width:36px;height:36px;font-size:0.85rem}
  .job-title{font-size:0.88rem}
  .job-company{font-size:0.78rem}
  .job-tag{font-size:0.62rem;padding:2px 6px}
  .job-time{font-size:0.62rem}
  .pagination{gap:4px}
  .page-btn{padding:6px 10px;font-size:0.72rem}
}
</style>
</head>
<body>

<!-- â•â• TOPBAR â•â• -->
<div class="topbar">
  <a href="index.html" class="logo"><div class="logo-icon">A</div>Ambore<span class="brand-tag">Jobs</span></a>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="dashboard.html">Dashboard</a>
    <a href="app.html">Interview</a>
    <a href="resume.html">Resume</a>
    <a href="jobs.html" class="active">Jobs</a>
  </div>
</div>

<!-- â•â• HERO / SEARCH â•â• -->
<div class="hero">
  <h1>Find Your Next <span>Tech Job</span></h1>
  <p>Thousands of fresh IT & Tech jobs across all 50 US states â€” updated daily.</p>
  <div class="stats-bar" id="stats-bar">
    <span class="stat-chip"><strong id="stat-jobs">--</strong> active jobs</span>
    <span class="stat-chip"><strong id="stat-companies">--</strong> companies</span>
    <span class="stat-chip">Updated <strong id="stat-updated">--</strong></span>
  </div>
  <div class="search-bar">
    <input type="text" id="search-input" placeholder="Search jobs, companies, skills..." onkeydown="if(event.key==='Enter')doSearch()"/>
    <select id="state-select">
      <option value="">All States</option>
    </select>
    <button class="search-btn" onclick="doSearch()">Search</button>
  </div>
  <div class="category-pills" id="category-pills"></div>
</div>

<!-- â•â• MAIN LAYOUT â•â• -->
<div class="main-layout">
  <!-- Sidebar Filters -->
  <div class="sidebar" id="sidebar">
    <button class="mobile-filter-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">
      Filters
    </button>

    <div class="filter-card">
      <div class="filter-title">Work Type</div>
      <label class="filter-option"><input type="checkbox" value="remote" onchange="applyFilters()"/> Remote <span class="count" id="count-remote"></span></label>
      <label class="filter-option"><input type="checkbox" value="hybrid" onchange="applyFilters()"/> Hybrid <span class="count" id="count-hybrid"></span></label>
      <label class="filter-option"><input type="checkbox" value="onsite" onchange="applyFilters()"/> On-site <span class="count" id="count-onsite"></span></label>
    </div>

    <div class="filter-card">
      <div class="filter-title">Experience Level</div>
      <label class="filter-option"><input type="checkbox" value="entry" onchange="applyFilters()"/> Entry Level</label>
      <label class="filter-option"><input type="checkbox" value="mid" onchange="applyFilters()"/> Mid Level</label>
      <label class="filter-option"><input type="checkbox" value="senior" onchange="applyFilters()"/> Senior</label>
      <label class="filter-option"><input type="checkbox" value="executive" onchange="applyFilters()"/> Executive</label>
    </div>

    <div class="filter-card">
      <div class="filter-title">Date Posted</div>
      <select class="filter-select" id="filter-date" onchange="applyFilters()">
        <option value="">Any time</option>
        <option value="1d">Last 24 hours</option>
        <option value="3d">Last 3 days</option>
        <option value="7d">Last 7 days</option>
        <option value="14d">Last 14 days</option>
        <option value="30d">Last 30 days</option>
      </select>
    </div>

    <div class="filter-card">
      <div class="filter-title">Minimum Salary</div>
      <select class="filter-select" id="filter-salary" onchange="applyFilters()">
        <option value="">Any salary</option>
        <option value="50000">$50,000+</option>
        <option value="75000">$75,000+</option>
        <option value="100000">$100,000+</option>
        <option value="125000">$125,000+</option>
        <option value="150000">$150,000+</option>
        <option value="200000">$200,000+</option>
      </select>
    </div>

    <div class="filter-card">
      <div class="filter-title">Source</div>
      <select class="filter-select" id="filter-source" onchange="applyFilters()">
        <option value="">All sources</option>
        <option value="greenhouse">Greenhouse</option>
        <option value="ashby">Ashby</option>
        <option value="workday">Workday</option>
        <option value="weworkremotely">WeWorkRemotely</option>
        <option value="remoteok">RemoteOK</option>
        <option value="lever">Lever</option>
        <option value="remotive">Remotive</option>
        <option value="themuse">The Muse</option>
        <option value="adzuna">Adzuna</option>
        <option value="serpapi">Google Jobs</option>
        <option value="usajobs">USAJobs (Gov)</option>
        <option value="taleo">Taleo</option>
        <option value="icims">iCIMS</option>
        <option value="linkedin">LinkedIn</option>
        <option value="apify">Indeed (via Apify)</option>
      </select>
    </div>

    <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
  </div>

  <!-- Jobs List -->
  <div class="jobs-area">
    <div class="jobs-header">
      <div class="jobs-count" id="jobs-count">Loading jobs...</div>
      <select class="sort-select" id="sort-select" onchange="applyFilters()">
        <option value="posted_at">Newest first</option>
        <option value="salary_max">Highest salary</option>
      </select>
    </div>
    <div id="jobs-list">
      <div class="loading"><div class="loading-spinner"></div>Loading jobs...</div>
    </div>
    <div class="pagination" id="pagination"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA SOURCE
   All jobs are loaded once from backend/jobs.json (scraped data).
   Filtering, searching, sorting, and pagination are all client-side.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const JOBS_JSON_URL = 'backend/jobs.json';
const PER_PAGE = 20;

let _allJobs   = [];   // full dataset loaded once
let _filtered  = [];   // subset after filters/search
let _jobsMap   = {};   // id â†’ job, for save-button lookup
let currentPage     = 1;
let currentCategory = '';
let totalPages      = 0;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOAD + BOOTSTRAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadJobsData() {
  const list = document.getElementById('jobs-list');
  list.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Loading jobs...</div>';
  try {
    const res = await fetch(JOBS_JSON_URL);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    _allJobs = await res.json();
  } catch (e) {
    list.innerHTML = `<div class="empty-state"><p>Could not load jobs.json â€” ${e.message}</p></div>`;
    return false;
  }
  return true;
}

function computeStats() {
  const companies = new Set(_allJobs.map(j => j.company)).size;
  const remote    = _allJobs.filter(j => j.is_remote).length;
  document.getElementById('stat-jobs').textContent      = _allJobs.length.toLocaleString();
  document.getElementById('stat-companies').textContent = companies.toLocaleString();
  document.getElementById('stat-updated').textContent   = 'today';
  // show remote count in third chip
  const chip = document.querySelector('.stat-chip:nth-child(3)');
  if (chip) chip.innerHTML = `<strong>${remote.toLocaleString()}</strong> remote jobs`;
}

function buildCategoryPills() {
  const counts = {};
  _allJobs.forEach(j => {
    if (j.department) counts[j.department] = (counts[j.department] || 0) + 1;
  });
  const top = Object.entries(counts).sort((a, b) => b[1] - a[1]).slice(0, 14);

  const pills = document.getElementById('category-pills');
  pills.innerHTML = '<button class="cat-pill active" onclick="selectCategory(\'\',this)">All Jobs</button>';
  top.forEach(([dept, cnt]) => {
    const safe = dept.replace(/'/g, "\\'");
    pills.innerHTML += `<button class="cat-pill" onclick="selectCategory('${safe}',this)">${escapeHtml(dept)} <span style="opacity:0.5;font-size:0.72em">(${cnt})</span></button>`;
  });
}

function buildStateDropdown() {
  const STATE_RE = /,\s*([A-Z]{2})(?:\s|$|,)/;
  const counts = {};
  _allJobs.forEach(j => {
    const m = STATE_RE.exec(j.location || '');
    if (m) counts[m[1]] = (counts[m[1]] || 0) + 1;
  });
  const sel = document.getElementById('state-select');
  Object.entries(counts)
    .sort((a, b) => b[1] - a[1])
    .forEach(([st, cnt]) => {
      const opt = document.createElement('option');
      opt.value = st;
      opt.textContent = `${st} (${cnt})`;
      sel.appendChild(opt);
    });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SMART QUERY NORMALIZER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ABBREV_MAP = {
  'js': 'javascript', 'ts': 'typescript', 'py': 'python',
  'ml': 'machine learning', 'ai': 'artificial intelligence',
  'dba': 'database administrator', 'qa': 'quality assurance',
  'sre': 'site reliability', 'ui': 'user interface', 'ux': 'user experience',
  'ios': 'iOS mobile', 'k8s': 'kubernetes', 'tf': 'terraform',
};
const SYNONYM_MAP = {
  'full stack':       'fullstack full-stack',
  'fullstack':        'full stack full-stack',
  'frontend':         'front-end react angular vue',
  'backend':          'back-end server-side api',
  'devops':           'site reliability infrastructure cicd',
  'data science':     'data scientist analytics machine learning',
  'machine learning': 'ml deep learning ai artificial intelligence',
  'ios':              'swift mobile apple',
  'android':          'kotlin mobile',
};

function normalizeQuery(raw) {
  let q = raw.toLowerCase().trim();
  Object.entries(ABBREV_MAP).forEach(([abbr, full]) => {
    q = q.replace(new RegExp(`\\b${abbr}\\b`, 'g'), full);
  });
  let extras = '';
  Object.entries(SYNONYM_MAP).forEach(([phrase, syns]) => {
    if (q.includes(phrase)) extras += ' ' + syns;
  });
  return (q + extras).trim();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPERIENCE LEVEL INFERENCE FROM JOB TITLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function inferLevel(title) {
  const t = (title || '').toLowerCase();
  if (/\b(director|vp |vice president|head of|chief|cto|ceo|coo|svp|evp)\b/.test(t)) return 'executive';
  if (/\b(senior|sr\.|staff|principal|lead|architect)\b/.test(t)) return 'senior';
  if (/\b(junior|jr\.|entry.?level|associate|intern|graduate|new grad)\b/.test(t)) return 'entry';
  return 'mid';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLIENT-SIDE FILTER + SORT + PAGINATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DATE_MS = { '1d': 864e5, '3d': 2592e5, '7d': 6048e5, '14d': 1209.6e6, '30d': 2592e6 };

function applyAndRender() {
  const rawQ        = document.getElementById('search-input').value.trim();
  const q           = rawQ ? normalizeQuery(rawQ) : '';
  const stateFilter = document.getElementById('state-select').value;
  const sortBy      = document.getElementById('sort-select').value;
  const dateFilter  = document.getElementById('filter-date').value;
  const salaryMin   = parseInt(document.getElementById('filter-salary').value) || 0;
  const sourceFilter= document.getElementById('filter-source').value;

  const workTypes = [...document.querySelectorAll(
    '.sidebar input[type=checkbox][value="remote"],' +
    '.sidebar input[type=checkbox][value="hybrid"],' +
    '.sidebar input[type=checkbox][value="onsite"]'
  )].filter(cb => cb.checked).map(cb => cb.value);

  const expLevels = [...document.querySelectorAll(
    '.sidebar input[type=checkbox][value="entry"],' +
    '.sidebar input[type=checkbox][value="mid"],' +
    '.sidebar input[type=checkbox][value="senior"],' +
    '.sidebar input[type=checkbox][value="executive"]'
  )].filter(cb => cb.checked).map(cb => cb.value);

  const now = Date.now();

  _filtered = _allJobs.filter(j => {
    // â”€â”€ Text search (every word must appear somewhere)
    if (q) {
      const hay = `${j.title} ${j.company} ${j.location} ${j.department||''} ${j.description||''}`.toLowerCase();
      if (!q.split(/\s+/).every(w => hay.includes(w))) return false;
    }
    // â”€â”€ Department / category pill
    if (currentCategory && j.department !== currentCategory) return false;
    // â”€â”€ US state
    if (stateFilter && !(j.location || '').includes(stateFilter)) return false;
    // â”€â”€ Work type
    if (workTypes.length) {
      const wt = j.is_remote ? 'remote' : 'onsite';
      if (!workTypes.includes(wt)) return false;
    }
    // â”€â”€ ATS source
    if (sourceFilter && j.ats !== sourceFilter) return false;
    // â”€â”€ Minimum salary
    if (salaryMin && (!j.salary_min || j.salary_min < salaryMin)) return false;
    // â”€â”€ Date posted
    if (dateFilter && j.posted_at) {
      if (now - new Date(j.posted_at).getTime() > (DATE_MS[dateFilter] || Infinity)) return false;
    }
    // â”€â”€ Experience level
    if (expLevels.length && !expLevels.includes(inferLevel(j.title))) return false;
    return true;
  });

  // â”€â”€ Sort
  if (sortBy === 'salary_max') {
    _filtered.sort((a, b) => (b.salary_max || 0) - (a.salary_max || 0));
  } else {
    _filtered.sort((a, b) => {
      const da = a.posted_at ? new Date(a.posted_at).getTime() : 0;
      const db = b.posted_at ? new Date(b.posted_at).getTime() : 0;
      return db - da;
    });
  }

  totalPages = Math.ceil(_filtered.length / PER_PAGE);
  const page = _filtered.slice((currentPage - 1) * PER_PAGE, currentPage * PER_PAGE);

  const list = document.getElementById('jobs-list');

  // Smart-search banner
  const prevBanner = document.getElementById('smart-search-banner');
  if (prevBanner) prevBanner.remove();
  if (rawQ && _filtered.length > 0) {
    const q2 = normalizeQuery(rawQ);
    const isExpanded = q2 !== rawQ.toLowerCase().trim();
    const kws = [...new Set(rawQ.split(/\s+/).filter(w => w.length > 2))];
    const banner = document.createElement('div');
    banner.id = 'smart-search-banner';
    banner.style.cssText = 'background:rgba(79,70,229,0.08);border:1px solid rgba(79,70,229,0.2);border-radius:8px;padding:8px 14px;margin-bottom:12px;font-size:0.8rem;color:rgba(255,255,255,0.55);display:flex;align-items:center;gap:8px;flex-wrap:wrap';
    banner.innerHTML = `<span style="color:#818CF8;font-weight:700">&#9670; Smart Search</span>
      Showing <strong style="color:#fff">${_filtered.length.toLocaleString()}</strong> results for:
      ${kws.map(k => `<span style="background:rgba(129,140,248,0.15);color:#818CF8;padding:1px 7px;border-radius:4px;font-size:0.76rem">${escapeHtml(k)}</span>`).join(' ')}
      ${isExpanded ? '<span style="opacity:0.5">+ related terms</span>' : ''}`;
    list.parentNode.insertBefore(banner, list);
  }

  document.getElementById('jobs-count').innerHTML = `<strong>${_filtered.length.toLocaleString()}</strong> jobs found`;

  if (page.length === 0) {
    list.innerHTML = '<div class="empty-state"><p>No jobs match your search. Try different keywords or clear some filters.</p></div>';
    document.getElementById('pagination').innerHTML = '';
    return;
  }

  list.innerHTML = page.map(renderJobCard).join('');
  renderPagination(currentPage, totalPages);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER A SINGLE JOB CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderJobCard(job) {
  _jobsMap[job.id] = job;

  const initial  = (job.company || '?').charAt(0).toUpperCase();
  const location = job.location || 'USA';

  // Work-type tag
  const wtClass = job.is_remote ? 'remote' : '';
  const wtLabel = job.is_remote ? 'Remote' : '';
  const workTypeTag = wtLabel ? `<span class="job-tag ${wtClass}">${wtLabel}</span>` : '';

  // Salary tag
  let salaryTag = '';
  if (job.salary_min || job.salary_max) {
    const lo = job.salary_min ? `$${(job.salary_min / 1000).toFixed(0)}k` : '';
    const hi = job.salary_max ? `$${(job.salary_max / 1000).toFixed(0)}k` : '';
    salaryTag = `<span class="job-tag salary">${lo && hi && lo !== hi ? `${lo}â€“${hi}` : hi || lo}</span>`;
  }

  // Department tag
  const deptTag = job.department
    ? `<span class="job-tag">${escapeHtml(job.department)}</span>`
    : '';

  // ATS source badge
  const atsLabels = { greenhouse: 'Greenhouse', lever: 'Lever', ashby: 'Ashby', workday: 'Workday', remotive: 'Remotive', themuse: 'The Muse', remoteok: 'RemoteOK', weworkremotely: 'WeWorkRemotely', usajobs: 'USAJobs', adzuna: 'Adzuna', serpapi: 'Google Jobs', linkedin: 'LinkedIn', apify: 'Indeed', icims: 'iCIMS', taleo: 'Taleo', html: 'Direct' };
  const atsTag = `<span class="job-tag">${atsLabels[job.ats] || job.ats || ''}</span>`;

  const timeStr = job.posted_at ? timeAgo(new Date(job.posted_at)) : '';
  const saved   = isSavedJob(job.id);
  const jid     = escapeHtml(job.id);

  return `
    <div class="job-card">
      <button id="svbtn-${jid}" class="save-job-btn ${saved ? 'saved' : ''}"
        onclick="toggleSaveJob(event,'${jid}')"
        title="${saved ? 'Saved to Dashboard' : 'Save job'}">${saved ? 'ğŸ”–' : 'âŠ• Save'}</button>
      <div class="job-card-top" onclick="window.open('${escapeHtml(job.url)}','_blank','noopener')" style="cursor:pointer">
        <div class="job-logo">${initial}</div>
        <div class="job-info">
          <div class="job-title">${escapeHtml(job.title)}</div>
          <div class="job-company">${escapeHtml(job.company)} &middot; ${escapeHtml(location)}</div>
          <div class="job-meta">
            ${workTypeTag}${salaryTag}${deptTag}${atsTag}
            <span class="job-time">${timeStr}</span>
          </div>
        </div>
      </div>
      <div class="job-card-actions">
        <button class="btn-tailor" onclick="tailorResume('${jid}')">âœ¨ Tailor Resume</button>
        <a class="btn-apply" href="${escapeHtml(job.url)}" target="_blank" rel="noopener noreferrer">Apply â†’</a>
      </div>
    </div>`;
}

function renderPagination(current, total) {
  const container = document.getElementById('pagination');
  if (total <= 1) { container.innerHTML = ''; return; }

  let html = `<button class="page-btn" onclick="goToPage(${current - 1})" ${current <= 1 ? 'disabled' : ''}>Prev</button>`;

  let start = Math.max(1, current - 3);
  let end   = Math.min(total, start + 6);
  if (end - start < 6) start = Math.max(1, end - 6);

  for (let i = start; i <= end; i++) {
    html += `<button class="page-btn ${i === current ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
  }
  html += `<button class="page-btn" onclick="goToPage(${current + 1})" ${current >= total ? 'disabled' : ''}>Next</button>`;
  container.innerHTML = html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERACTION HANDLERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doSearch()    { currentPage = 1; applyAndRender(); }
function applyFilters(){ currentPage = 1; applyAndRender(); }

function selectCategory(cat, el) {
  currentCategory = cat;
  currentPage = 1;
  document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
  if (el) el.classList.add('active');
  applyAndRender();
}

function clearAllFilters() {
  document.getElementById('search-input').value  = '';
  document.getElementById('state-select').value  = '';
  document.getElementById('filter-date').value   = '';
  document.getElementById('filter-salary').value = '';
  document.getElementById('filter-source').value = '';
  document.querySelectorAll('.sidebar input[type=checkbox]').forEach(cb => cb.checked = false);
  currentCategory = '';
  currentPage     = 1;
  document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
  document.querySelector('.cat-pill')?.classList.add('active');
  applyAndRender();
}

function goToPage(page) {
  if (page < 1 || page > totalPages) return;
  currentPage = page;
  applyAndRender();
  window.scrollTo({ top: 300, behavior: 'smooth' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function timeAgo(date) {
  const diff = Date.now() - date;
  const mins = Math.floor(diff / 60000);
  if (mins < 1)  return 'just now';
  if (mins < 60) return `${mins}m ago`;
  const hrs = Math.floor(mins / 60);
  if (hrs < 24)  return `${hrs}h ago`;
  const days = Math.floor(hrs / 24);
  if (days === 1)  return '1 day ago';
  if (days < 30)   return `${days} days ago`;
  return date.toLocaleDateString();
}

function escapeHtml(str) {
  const d = document.createElement('div');
  d.textContent = str || '';
  return d.innerHTML;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE JOB â€” localStorage (dashboard-compatible schema)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function savedJobsKey() {
  const s = JSON.parse(localStorage.getItem('ambore_user') || 'null');
  return s ? 'ambore_saved_jobs_' + s.id : null;
}

function isSavedJob(jobId) {
  const key = savedJobsKey();
  if (!key) return false;
  return JSON.parse(localStorage.getItem(key) || '[]').some(j => j.id === jobId);
}

function toggleSaveJob(e, jobId) {
  e.preventDefault();
  e.stopPropagation();
  const key = savedJobsKey();
  if (!key) { showToast('Please log in to save jobs.'); return; }
  const job = _jobsMap[jobId];
  if (!job) return;

  let saved  = JSON.parse(localStorage.getItem(key) || '[]');
  const already = saved.some(j => j.id === jobId);

  if (already) {
    saved = saved.filter(j => j.id !== jobId);
    showToast('Removed from Dashboard');
  } else {
    // Map scraped schema â†’ dashboard Saved Jobs schema
    const locParts = (job.location || '').split(',').map(s => s.trim());
    saved.unshift({
      id:             job.id,
      title:          job.title,
      company:        job.company,
      location_city:  locParts[0] || '',
      location_state: locParts[1] || '',
      apply_url:      job.url,           // scraped: job.url = apply link
      salary_min:     job.salary_min,
      salary_max:     job.salary_max,
      work_type:      job.is_remote ? 'remote' : 'onsite',
      category:       job.department || '',
      source:         job.ats || '',
      posted_at:      job.posted_at,
      savedAt:        new Date().toISOString(),
      isApplied:      false,
      applicationId:  null,
    });
    showToast('Saved to Dashboard â†’');
  }

  localStorage.setItem(key, JSON.stringify(saved));
  const btn = document.getElementById('svbtn-' + jobId);
  if (btn) {
    if (already) { btn.textContent = 'âŠ• Save'; btn.title = 'Save job'; btn.classList.remove('saved'); }
    else         { btn.textContent = 'ğŸ”–';     btn.title = 'Saved to Dashboard'; btn.classList.add('saved'); }
  }
}

function tailorResume(jobId) {
  const job = _jobsMap[jobId];
  if (!job) return;

  // Build a clean job description text for the resume tailoring tool
  let desc = '';
  if (job.title)   desc += `Job Title: ${job.title}\n`;
  if (job.company) desc += `Company: ${job.company}\n`;
  if (job.location)desc += `Location: ${job.location}\n`;
  if (job.salary_min || job.salary_max) {
    const lo = job.salary_min ? `$${(job.salary_min/1000).toFixed(0)}k` : '';
    const hi = job.salary_max ? `$${(job.salary_max/1000).toFixed(0)}k` : '';
    desc += `Salary: ${lo && hi ? lo+'â€“'+hi : hi||lo}\n`;
  }
  if (job.department) desc += `Department: ${job.department}\n`;
  desc += '\n';
  if (job.description) desc += job.description;

  // Store in localStorage so resume.html can pre-fill the JD textarea
  localStorage.setItem('ambore_prefill_job', JSON.stringify({
    title:    job.title   || '',
    company:  job.company || '',
    applyUrl: job.url     || '',
    description: desc,
  }));

  window.location.href = 'resume.html';
}

function showToast(msg) {
  let t = document.getElementById('jobs-toast');
  if (!t) {
    t = document.createElement('div');
    t.id = 'jobs-toast';
    t.style.cssText = 'position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#1e1e3a;border:1px solid rgba(129,140,248,0.3);color:#fff;padding:10px 20px;border-radius:10px;font-size:0.85rem;font-weight:600;z-index:9999;box-shadow:0 4px 20px rgba(0,0,0,0.4);transition:opacity 0.3s;pointer-events:none';
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.opacity = '1';
  clearTimeout(t._to);
  t._to = setTimeout(() => { t.style.opacity = '0'; }, 2500);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('load', async () => {
  // Apply URL params for pre-set search/filters
  const p = new URLSearchParams(window.location.search);
  if (p.get('q'))        document.getElementById('search-input').value = p.get('q');
  if (p.get('category')) currentCategory = p.get('category');
  if (p.get('state'))    document.getElementById('state-select').value = p.get('state');

  const ok = await loadJobsData();
  if (!ok) return;

  computeStats();
  buildCategoryPills();
  buildStateDropdown();
  applyAndRender();
});
</script>
</body>
</html>
