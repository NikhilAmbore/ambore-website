<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Job Details — Ambore Jobs</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'><stop offset='0%25' stop-color='%234F46E5'/><stop offset='100%25' stop-color='%237C3AED'/></linearGradient></defs><rect width='100' height='100' rx='22' fill='url(%23g)'/><text x='50' y='72' font-size='62' font-family='Arial,sans-serif' font-weight='900' fill='white' text-anchor='middle'>A</text></svg>"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html,body{min-height:100vh;font-family:'Inter',sans-serif;background:#06060f;color:#e2e8f0}
:root{--grad:linear-gradient(135deg,#4F46E5,#7C3AED);--card:#0e0e1d;--card2:#13132a;--border:rgba(255,255,255,0.08);--accent:#818CF8;--green:#22c55e;--yellow:#fbbf24;--red:#ef4444}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.1);border-radius:2px}
button,input,textarea,select{font-family:inherit}
a{text-decoration:none;color:inherit}

/* Topbar */
.topbar{display:flex;align-items:center;gap:12px;padding:14px 24px;border-bottom:1px solid var(--border);background:rgba(14,14,29,0.9);position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.topbar .logo{display:flex;align-items:center;gap:8px;font-size:1rem;font-weight:900;color:#fff}
.topbar .logo-icon{width:28px;height:28px;border-radius:8px;background:var(--grad);display:flex;align-items:center;justify-content:center;font-size:0.85rem;font-weight:900;color:#fff}
.topbar .brand-tag{font-size:0.7rem;font-weight:700;color:var(--accent);background:rgba(79,70,229,0.15);padding:2px 8px;border-radius:6px;margin-left:2px}
.nav-links{display:flex;align-items:center;gap:16px;margin-left:20px}
.nav-links a{font-size:0.82rem;font-weight:600;color:rgba(255,255,255,0.4);transition:color 0.2s}
.nav-links a:hover{color:#fff}
.nav-links a.active{color:var(--accent)}

/* Main content */
.content{max-width:820px;margin:0 auto;padding:24px 24px 100px}
.back-link{display:inline-flex;align-items:center;gap:6px;font-size:0.82rem;color:rgba(255,255,255,0.4);margin-bottom:20px;transition:color 0.2s}
.back-link:hover{color:#fff}

/* Job header */
.job-header{display:flex;gap:18px;align-items:flex-start;margin-bottom:24px}
.jh-logo{width:60px;height:60px;border-radius:14px;background:rgba(79,70,229,0.15);display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:1.4rem;font-weight:800;color:var(--accent);overflow:hidden}
.jh-logo img{width:100%;height:100%;object-fit:cover;border-radius:14px}
.jh-info{flex:1}
.jh-title{font-size:1.5rem;font-weight:900;color:#fff;line-height:1.3;margin-bottom:4px}
.jh-company{font-size:1rem;color:rgba(255,255,255,0.5);margin-bottom:10px}
.jh-tags{display:flex;flex-wrap:wrap;gap:6px}
.jh-tag{font-size:0.72rem;font-weight:600;padding:4px 10px;border-radius:7px;background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.5);border:1px solid var(--border)}
.jh-tag.remote{color:var(--green);border-color:rgba(34,197,94,0.25);background:rgba(34,197,94,0.08)}
.jh-tag.hybrid{color:var(--yellow);border-color:rgba(251,191,36,0.25);background:rgba(251,191,36,0.08)}
.jh-tag.salary{color:var(--accent);border-color:rgba(79,70,229,0.25);background:rgba(79,70,229,0.08)}

/* Info grid */
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-bottom:24px}
.info-item{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:14px}
.info-label{font-size:0.68rem;font-weight:700;color:rgba(255,255,255,0.35);text-transform:uppercase;letter-spacing:0.06em;margin-bottom:4px}
.info-value{font-size:0.9rem;font-weight:600;color:#fff}

/* Apply button */
.apply-btn{
  display:inline-flex;align-items:center;gap:8px;padding:14px 36px;
  background:var(--grad);border:none;border-radius:12px;color:#fff;
  font-size:1rem;font-weight:800;cursor:pointer;transition:opacity 0.2s;
  margin-bottom:28px;
}
.apply-btn:hover{opacity:0.88}

/* Description */
.desc-card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px 28px;margin-bottom:24px}
.desc-title{font-size:0.95rem;font-weight:800;color:#fff;margin-bottom:14px}
.desc-body{font-size:0.88rem;line-height:1.75;color:rgba(255,255,255,0.7)}
.desc-body p{margin-bottom:10px}
.desc-body ul,.desc-body ol{padding-left:20px;margin-bottom:10px}
.desc-body li{margin-bottom:4px}

/* Skills */
.skills-wrap{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:24px}
.skill-chip{font-size:0.72rem;font-weight:600;padding:4px 10px;border-radius:20px;background:rgba(79,70,229,0.12);color:var(--accent);border:1px solid rgba(79,70,229,0.2)}

/* Source badge */
.source-badge{font-size:0.75rem;color:rgba(255,255,255,0.35);margin-top:8px}

/* Loading */
.loading{text-align:center;padding:80px 20px;color:rgba(255,255,255,0.3)}
.loading-spinner{width:32px;height:32px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 12px}
@keyframes spin{to{transform:rotate(360deg)}}

/* Sticky apply bar — always visible at bottom */
.apply-sticky{
  position:fixed;bottom:0;left:0;right:0;z-index:200;
  padding:12px 24px;background:rgba(6,6,15,0.95);backdrop-filter:blur(12px);
  border-top:1px solid var(--border);display:none;
}
.apply-sticky.visible{display:block}
.apply-sticky-inner{max-width:820px;margin:0 auto;display:flex;align-items:center;gap:14px}
.apply-sticky-info{flex:1;min-width:0}
.apply-sticky-title{font-size:0.88rem;font-weight:700;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.apply-sticky-company{font-size:0.75rem;color:rgba(255,255,255,0.4)}
.apply-sticky a{
  display:inline-flex;align-items:center;gap:8px;
  padding:12px 32px;background:var(--grad);border-radius:12px;
  color:#fff;font-size:0.95rem;font-weight:800;white-space:nowrap;
  transition:opacity 0.2s;flex-shrink:0;
}
.apply-sticky a:hover{opacity:0.88}

/* Mobile */
@media(max-width:640px){
  .topbar{padding:10px 14px;gap:8px;flex-wrap:wrap}
  .topbar .logo{font-size:0.9rem}
  .nav-links{margin-left:0;gap:10px;order:3;width:100%;justify-content:center;padding-top:6px;border-top:1px solid var(--border)}
  .content{padding:16px 14px 90px}
  .job-header{flex-direction:column;gap:12px}
  .jh-logo{width:48px;height:48px;font-size:1.2rem}
  .jh-title{font-size:1.2rem}
  .jh-company{font-size:0.88rem}
  .info-grid{grid-template-columns:1fr 1fr;gap:8px}
  .info-item{padding:10px}
  .desc-card{padding:16px}
  .apply-btn{width:100%;justify-content:center}
  .apply-sticky{padding:10px 14px}
  .apply-sticky-info{display:none}
  .apply-sticky a{width:100%;justify-content:center;padding:14px}
}
</style>
</head>
<body>

<div class="topbar">
  <a href="index.html" class="logo"><div class="logo-icon">A</div>Ambore<span class="brand-tag">Jobs</span></a>
  <div class="nav-links">
    <a href="index.html">Home</a>
    <a href="app.html">Interview</a>
    <a href="resume.html">Resume</a>
    <a href="jobs.html" class="active">Jobs</a>
  </div>
</div>

<div class="content" id="content">
  <div class="loading"><div class="loading-spinner"></div>Loading job details...</div>
</div>

<!-- Sticky apply bar (shown on all screen sizes) -->
<div class="apply-sticky" id="apply-sticky"></div>

<script>
const API_BASE = 'https://web-production-d62ab.up.railway.app';

async function loadJob() {
  const params = new URLSearchParams(window.location.search);
  const jobId = params.get('id');

  if (!jobId) {
    document.getElementById('content').innerHTML = '<div class="loading"><p>No job ID provided. <a href="jobs.html" style="color:var(--accent)">Browse jobs</a></p></div>';
    return;
  }

  try {
    const res = await fetch(`${API_BASE}/api/jobs/${jobId}`);
    if (!res.ok) throw new Error('Job not found');
    const job = await res.json();

    document.title = `${job.title} at ${job.company} — Ambore Jobs`;
    renderJob(job);
  } catch (e) {
    document.getElementById('content').innerHTML = `<div class="loading"><p>Job not found or server error.</p><p style="margin-top:8px"><a href="jobs.html" style="color:var(--accent)">Browse all jobs</a></p></div>`;
  }
}

function renderJob(job) {
  const location = [job.location_city, job.location_state].filter(Boolean).join(', ') || 'USA';

  let salaryStr = '';
  if (job.salary_min || job.salary_max) {
    const min = job.salary_min ? `$${job.salary_min.toLocaleString()}` : '';
    const max = job.salary_max ? `$${job.salary_max.toLocaleString()}` : '';
    salaryStr = min && max && min !== max ? `${min} – ${max}` : (max || min);
  }

  const logo = job.company_logo
    ? `<img src="${job.company_logo}" alt="" onerror="this.parentElement.innerHTML='${esc(job.company.charAt(0))}'">`
    : esc(job.company.charAt(0));

  const workTypeClass = job.work_type === 'remote' ? 'remote' : job.work_type === 'hybrid' ? 'hybrid' : '';

  const skillsHtml = job.skills && job.skills.length
    ? `<div class="skills-wrap">${job.skills.map(s => `<span class="skill-chip">${esc(s)}</span>`).join('')}</div>`
    : '';

  // Format description paragraphs
  let descHtml = esc(job.description || 'No description available.');
  descHtml = descHtml.replace(/\n\n+/g, '</p><p>').replace(/\n/g, '<br>');
  descHtml = `<p>${descHtml}</p>`;

  const postedDate = job.posted_at ? new Date(job.posted_at).toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' }) : '';

  document.getElementById('content').innerHTML = `
    <a href="jobs.html" class="back-link">&larr; Back to Jobs</a>

    <div class="job-header">
      <div class="jh-logo">${logo}</div>
      <div class="jh-info">
        <h1 class="jh-title">${esc(job.title)}</h1>
        <div class="jh-company">${esc(job.company)} &middot; ${esc(location)}</div>
        <div class="jh-tags">
          ${job.work_type ? `<span class="jh-tag ${workTypeClass}">${esc(job.work_type)}</span>` : ''}
          ${salaryStr ? `<span class="jh-tag salary">${salaryStr}/yr</span>` : ''}
          ${job.experience_level ? `<span class="jh-tag">${esc(job.experience_level)}</span>` : ''}
          ${job.category ? `<span class="jh-tag">${esc(job.category)}</span>` : ''}
        </div>
      </div>
    </div>

    <div class="info-grid">
      <div class="info-item"><div class="info-label">Location</div><div class="info-value">${esc(location)}</div></div>
      <div class="info-item"><div class="info-label">Work Type</div><div class="info-value">${esc(job.work_type || 'On-site')}</div></div>
      ${salaryStr ? `<div class="info-item"><div class="info-label">Salary</div><div class="info-value">${salaryStr}/yr</div></div>` : ''}
      <div class="info-item"><div class="info-label">Experience</div><div class="info-value">${esc(job.experience_level || 'Not specified')}</div></div>
      ${postedDate ? `<div class="info-item"><div class="info-label">Posted</div><div class="info-value">${postedDate}</div></div>` : ''}
      <div class="info-item"><div class="info-label">Source</div><div class="info-value">${esc(job.source)}</div></div>
    </div>

    <a href="${getApplyUrl(job)}" target="_blank" rel="noopener" class="apply-btn">Apply Now &rarr;</a>

    ${skillsHtml}

    <div class="desc-card">
      <div class="desc-title">Job Description</div>
      <div class="desc-body">${descHtml}</div>
    </div>

    <div class="source-badge">Source: ${esc(job.source)} &middot; Job ID: ${job.id}</div>
  `;

  // Populate sticky apply bar — always show
  const stickyBar = document.getElementById('apply-sticky');
  stickyBar.innerHTML = `
    <div class="apply-sticky-inner">
      <div class="apply-sticky-info">
        <div class="apply-sticky-title">${esc(job.title)}</div>
        <div class="apply-sticky-company">${esc(job.company)}</div>
      </div>
      <a href="${getApplyUrl(job)}" target="_blank" rel="noopener">Apply Now &rarr;</a>
    </div>`;
  stickyBar.classList.add('visible');
}

function getApplyUrl(job) {
  if (job.apply_url) return esc(job.apply_url);
  // No direct apply link — generate a Google search to find the application page
  const query = encodeURIComponent(`${job.title} ${job.company} apply`);
  return `https://www.google.com/search?q=${query}`;
}

function esc(str) {
  const div = document.createElement('div');
  div.textContent = str || '';
  return div.innerHTML;
}

window.addEventListener('load', loadJob);
</script>
</body>
</html>
